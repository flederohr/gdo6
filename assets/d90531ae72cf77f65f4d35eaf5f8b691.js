function GWS_Message(t){return this.SYNC=0,this.INDEX=0,this.LENGTH=0,this.CMD=-1,t?(this.BUFFER=new DataView(t),this.LENGTH=t.byteLength):this.BUFFER=[],this.isSync=function(){return 0<this.LENGTH&&0<(128&this.BUFFER.getUint8(0))},this.index=function(t){return void 0!==t&&(this.INDEX=t),this.INDEX},this.binaryBuffer=function(){for(var t=this.BUFFER.length,i=new Uint8Array(t),e=0;e<t;e++)i[e]=this.BUFFER[e];return i.buffer},this.hasMore=function(){return this.INDEX<this.LENGTH},this.read8=function(t){return this.readN(1,t)},this.read16=function(t){return this.readN(2,t)},this.read24=function(t){return this.readN(3,t)},this.read32=function(t){return this.readN(4,t)},this.read64=function(t){return this.readN(8,t)},this.readN=function(t,i){i=void 0===i?this.INDEX:i;for(var e=0,n=0;n<t;n++)e<<=8,e|=this.BUFFER.getUint8(i++);return this.INDEX=i,e},this.readString=function(t){this.index(t);for(var i="";code=this.read8();)i+=String.fromCharCode(code);return decodeURIComponent(i)},this.readFloat=function(t){t=this.BUFFER.getFloat32(this.index(t),!0);return this.INDEX+=4,t},this.readDouble=function(t){t=this.BUFFER.getFloat64(this.index(t),!0);return this.INDEX+=8,t},this.readCmd=function(){return this.CMD=this.CMD<0?32767&this.read16():this.CMD,this.CMD},this.readMid=function(){return this.read24()},this.write8=function(t,i){return this.writeN(1,t,i)},this.write16=function(t,i){return this.writeN(2,t,i)},this.write24=function(t,i){return this.writeN(3,t,i)},this.write32=function(t,i){return this.writeN(4,t,i)},this.write64=function(t,i){return this.writeN(8,t,i)},this.writeN=function(t,i,e){e=void 0===e?this.INDEX:e,i=parseInt(i);for(var n=e+t-1,r=0;r<t;r++)this.BUFFER[n--]=255&i,e++,i>>=8;return this.LENGTH=this.BUFFER.length,this.INDEX=e,this},this.writeString=function(t,i){for(var e=encodeURIComponent(t),n=e.length,r=0;r<n;)this.write8(e.charCodeAt(r++));return this.write8(0)},this.writeFloat=function(t,i){return this.write32(GWS_Message.FloatToInt32(t))},this.writeDouble=function(t,i){t=GWS_Message.DoubleToInt64(t);return this.write32(t[0]).write32(t[1])},this.cmd=function(t){return this.write16(t)},this.async=function(){return this.SYNC=0,this.write32()},this.sync=function(){return this.BUFFER[0]|=128,this.SYNC=GWS_Message.nextMid(),this.write24(this.SYNC)},this.dump=function(){for(var t="",i=0;i<this.LENGTH;)t+=sprintf(" %02X",this.BUFFER.getUint8?this.BUFFER.getUint8(i++):this.BUFFER[i++]);return t},this}GWS_Message.NEXT_MID=1,GWS_Message.nextMid=function(){return GWS_Message.NEXT_MID++},GWS_Message.FLOATBUF=new DataView(new ArrayBuffer(8)),GWS_Message.FloatToInt32=function(t){var i=GWS_Message.FLOATBUF;return i.setFloat32(0,t),i.getUint32(0)},GWS_Message.DoubleToInt64=function(t){var i=GWS_Message.FLOATBUF;return i.setFloat64(0,t),[i.getUint32(4),i.getUint32(0)]};